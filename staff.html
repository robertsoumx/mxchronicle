<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MX Chronicles Â· Staff Portal</title>
<link rel="stylesheet" href="style.css">
<script src="data.js" defer></script>
<script src="articles.js" defer></script>
</head>
<body>

<!-- PASSWORD OVERLAY -->
<div id="password-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#000a; display:flex; justify-content:center; align-items:center; z-index:999;">
  <div style="background:#fbf8f2; padding:2rem; border:5px solid #8b0000; text-align:center; border-radius:10px;">
    <h2 style="font-family:'Merriweather', serif;">Enter Staff Portal Password</h2>
    <input type="password" id="staff-password" placeholder="Password" style="padding:0.5rem; margin-top:1rem; width:80%;">
    <br>
    <button onclick="checkPassword()" style="margin-top:1rem; padding:0.5rem 1rem;">Enter</button>
    <p id="password-error" style="color:red; margin-top:0.5rem; display:none;">Incorrect password</p>
  </div>
</div>

<!-- STAFF PORTAL -->
<main id="staff-portal" style="display:none; padding:2rem;">

<header class="top-bar">
  <div class="masthead">MX CHRONICLES</div>
  <nav class="top-nav">
    <a href="index.html">HOME</a>
    <a href="articles.html">ARTICLES</a>
    <a href="about.html">ABOUT</a>
    <a href="staff.html" class="active">STAFF PORTAL</a>
  </nav>
</header>

<!-- STAFF MANAGEMENT -->
<section style="margin-bottom:2rem;">
  <h2>Staff Members</h2>
  <div id="staff-list" style="margin-bottom:1rem;"></div>
  <input type="text" id="new-staff" placeholder="New staff name" style="padding:0.5rem;">
  <button onclick="addStaff()">Add Staff</button>
</section>

<!-- ARTICLE MANAGEMENT -->
<section>
  <h2>Articles</h2>
  <div class="article-grid" id="staff-articles"></div>
</section>

</main>

<script>
// PASSWORD CHECK
function checkPassword(){
  const pwInput = document.getElementById('staff-password').value;
  if(pwInput === "26MXChronicles"){
    document.getElementById('password-overlay').style.display = 'none';
    document.getElementById('staff-portal').style.display = 'block';
    renderStaffPortal();
  } else {
    document.getElementById('password-error').style.display = 'block';
  }
}

// -----------------------
// STAFF PORTAL FUNCTIONS
// -----------------------
function getStaff(){
  return JSON.parse(localStorage.getItem('staff')) || [];
}
function saveStaff(staff){
  localStorage.setItem('staff', JSON.stringify(staff));
}

// Render staff list
function renderStaffList(){
  const staffContainer = document.getElementById('staff-list');
  const staff = getStaff();
  staffContainer.innerHTML = '';
  staff.forEach((name, idx)=>{
    const div = document.createElement('div');
    div.className = 'staff-name';
    div.style.marginBottom = '0.5rem';
    div.innerHTML = `${name} <button onclick="removeStaff(${idx})">Remove</button>`;
    staffContainer.appendChild(div);
  });
}

// Add staff
function addStaff(){
  const input = document.getElementById('new-staff');
  let staff = getStaff();
  const name = input.value.trim();
  if(name){
    staff.push(name);
    input.value = '';
    saveStaff(staff);
    renderStaffList();
  }
}

// Remove staff
function removeStaff(idx){
  let staff = getStaff();
  staff.splice(idx,1);
  saveStaff(staff);
  renderStaffList();
}

// -----------------------
// ARTICLE MANAGEMENT
// -----------------------
function renderStaffArticles(){
  const articles = JSON.parse(localStorage.getItem('articles')) || {};
  const grid = document.getElementById('staff-articles');
  grid.innerHTML = '';

  Object.entries(articles).forEach(([id,a])=>{
    const div = document.createElement('div');
    div.className = 'article-card';
    div.innerHTML = `
      <form onsubmit="saveArticle(event,'${id}')">
        <h2 class="article-title">Edit: ${a.title.toUpperCase()}</h2>
        <div class="article-meta">
          Issue: <input type="number" name="issue" value="${a.issue}" style="width:60px;"> |
          Author: <input type="text" name="author" value="${a.author}"> |
          Date: <input type="date" name="date" value="${a.date}">
        </div>
        <input type="text" name="title" value="${a.title}" style="width:100%; margin:0.5rem 0;">
        <textarea name="content" style="width:100%; height:80px;">${a.content}</textarea>
        ${a.image?`<img src="${a.image}" style="width:100%; margin:0.5rem 0;">`:''}
        <div style="margin-top:0.5rem;">
          <button type="submit">Save</button>
          <button type="button" onclick="deleteArticle('${id}')">Delete</button>
          <button type="button" onclick="toggleFeature('${id}')">${a.featured?'Unfeature':'Feature'}</button>
        </div>
      </form>
    `;
    grid.appendChild(div);
  });
}

// Save inline edits
function saveArticle(e,id){
  e.preventDefault();
  const form = e.target;
  const articles = JSON.parse(localStorage.getItem('articles'));
  const a = articles[id];
  a.title = form.title.value;
  a.author = form.author.value;
  a.date = form.date.value;
  a.issue = form.issue.value;
  a.content = form.content.value;
  saveArticles(articles);
  renderStaffArticles();
}

// Delete article
function deleteArticle(id){
  if(confirm("Delete this article?")){
    const articles = JSON.parse(localStorage.getItem('articles'));
    delete articles[id];
    saveArticles(articles);
    renderStaffArticles();
  }
}

// Toggle feature
function toggleFeature(id){
  const articles = JSON.parse(localStorage.getItem('articles'));
  articles[id].featured = !articles[id].featured;
  saveArticles(articles);
  renderStaffArticles();
}

// Render portal
function renderStaffPortal(){
  renderStaffList();
  renderStaffArticles();
}
</script>
</body>
</html>
